<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="../_static/favicon_16x16.png" sizes="16x11" rel="icon" type="image/png">
    <link href="../_static/favicon_32x32.png" sizes="32x21" rel="icon" type="image/png">
    <title>Test &amp; Verification &#8212; elos  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=4f649999" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=039e1c02" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="The project documentation" href="../doc/index.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="test-verification">
<h1>Test &amp; Verification<a class="headerlink" href="#test-verification" title="Link to this heading">¶</a></h1>
<p>Goal:</p>
<p>This document shall outline all measures taken to ensure that the software fulfills the intended purpose and does not have unwanted behavior.
Alongside the project there are several techniques and measurements used and
different test setups developed, to ensure the expected behavior.</p>
<p>[[<em>TOC</em>]]</p>
<section id="coding-guideline">
<h2>Coding Guideline<a class="headerlink" href="#coding-guideline" title="Link to this heading">¶</a></h2>
<p>Goal:</p>
<p>A coding guideline was defined to reduce common programming error and to increase readability and thus understandability of the code.</p>
<p>The to be used coding guideline is found here: link, Version x</p>
<p>The guideline is checked during static analysis step, described below.</p>
</section>
<section id="development-process">
<h2>Development process<a class="headerlink" href="#development-process" title="Link to this heading">¶</a></h2>
<p>Goal:</p>
<p>All changes to the repository shall be reviewed by an additional person, that is experienced with the software. Hence four-eyes have checked each modification.</p>
<p>The check is documented by means merge- or pull requests of the gitlab/github system.</p>
</section>
<section id="static-analysis">
<h2>Static analysis<a class="headerlink" href="#static-analysis" title="Link to this heading">¶</a></h2>
<p>Goal:</p>
<p>Static analysis shall verify that the coding guideline was fulfilled and common rules of secure and safe programming are followed.</p>
<p>The CI system is responsible of running the check regularly.</p>
<section id="gccs-static-analyzer">
<h3>GCCs Static Analyzer<a class="headerlink" href="#gccs-static-analyzer" title="Link to this heading">¶</a></h3>
<p>On default build with GCCs Static Analyzer enabled</p>
<ul class="simple">
<li><p>to find common programming issues the project is build on default with GCC’s Static Analyzer enabled</p></li>
<li><p>To explicitly disable it for some reasons (i.e perf benchmarks see. profiling) build with <code class="docutils literal notranslate"><span class="pre">cmake</span> <span class="pre">-DENABLE_ANALYZER=off</span></code></p></li>
</ul>
</section>
</section>
<section id="testing">
<h2>Testing<a class="headerlink" href="#testing" title="Link to this heading">¶</a></h2>
<p>Goal:</p>
<p>During tests the capabilities of the software are verified. Basically the question is answered: Does the software (or parts from it) react as intended?</p>
<section id="unit-test-test-utest">
<h3>Unit Test test/utest<a class="headerlink" href="#unit-test-test-utest" title="Link to this heading">¶</a></h3>
<p>Goal:</p>
<p>unit-tests verify the the correct function on the lowest level of the software. e.g. they verify that a c function returns the correct values on given input.</p>
<p>The CI system is responsible of running the utests regularly.</p>
<p>Details:</p>
<ul class="simple">
<li><p>covers all parts of src/</p></li>
<li><p>structure is &lt;component-name&gt;/&lt;compilation-unit-name&gt;/public_function_name/case_&lt;error|exterr|successful|…&gt;.c</p></li>
<li><p>how to run the utest from git project root:</p>
<ul>
<li><p>call |<code class="docutils literal notranslate"><span class="pre">./elos/ci/run_utest.sh</span></code>| to run the unit tests for the debug build</p></li>
<li><p>call |<code class="docutils literal notranslate"><span class="pre">./elos/ci/run_utest.sh</span> <span class="pre">Release</span></code>| to run the unit tests for the release build</p></li>
</ul>
</li>
<li><p>coverage is proven by asmcov, because gcov has dependencies on glibc and the test actually mock libc functions to achieve 100% branch coverage. (gcov and libc mocking doesn’t work)</p></li>
<li><p>executed by CI-pipeline</p></li>
<li><p>controlling the build of unit test with <code class="docutils literal notranslate"><span class="pre">cmake</span> <span class="pre">-DUNIT_TESTS=&amp;lt;on/off&amp;gt;</span> <span class="pre">-DINSTALL_UNIT_TEST&amp;lt;on/off&amp;gt;</span></code></p></li>
<li><p>unit tests shall make use of the  sanitizers</p></li>
</ul>
<section id="coverage-by-asmcov">
<h4>Coverage by asmcov<a class="headerlink" href="#coverage-by-asmcov" title="Link to this heading">¶</a></h4>
<p>To generate a coverage report for the unit tests asmcov is used. The basic steps are:</p>
<ol class="arabic simple">
<li><p>Run and trace the unit test with <code class="docutils literal notranslate"><span class="pre">perf</span></code> -&gt; perf.data</p></li>
<li><p>Create the the instruction stream with perf -&gt; perf.trace</p></li>
<li><p>Evaluate test binary and trace with asmcov to get a coverage statement -&gt; asmcov.log</p></li>
</ol>
</section>
<section id="usage">
<h4>Usage<a class="headerlink" href="#usage" title="Link to this heading">¶</a></h4>
<p>Currently two usage scenarios are supported:</p>
<ul class="simple">
<li><p>For the CI build: create coverage for all available unit tests</p></li>
<li><p>For the developer: create coverage for a given test or group of tests</p></li>
</ul>
<section id="to-create-a-complete-coverage-report-for-the-project-simply-run">
<h5>To create a complete coverage report for the project simply run:<a class="headerlink" href="#to-create-a-complete-coverage-report-for-the-project-simply-run" title="Link to this heading">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">elos</span><span class="o">/</span><span class="n">ci</span><span class="o">/</span><span class="n">create_coverage</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>The results can be found in <code class="docutils literal notranslate"><span class="pre">./build-coverage/coverage_results</span></code></p>
</section>
<section id="to-create-a-coverage-report-for-a-certain-or-group-of-unit-test-s-proceed-as-follows">
<h5>To create a coverage report for a certain or group of unit test(s) proceed as follows:<a class="headerlink" href="#to-create-a-coverage-report-for-a-certain-or-group-of-unit-test-s-proceed-as-follows" title="Link to this heading">¶</a></h5>
<ol class="arabic simple">
<li><p>build without Address Sanitizer support, to avoid additional code added by the gcc or be aware that probably not 100% branch coverage can be achieved as this code is not under your control.</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cmake</span> <span class="o">-</span><span class="n">B</span> <span class="o">./</span><span class="n">build</span><span class="o">-</span><span class="n">coverage</span> <span class="n">elos</span> <span class="o">-</span><span class="n">DCMAKE_BUILD_TYPE</span><span class="o">=</span><span class="n">Release</span>
<span class="n">make</span> <span class="o">-</span><span class="n">C</span> <span class="o">./</span><span class="n">build</span><span class="o">-</span><span class="n">coverage</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>run the coverage suite</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">BUILD_DIR</span><span class="o">=./</span><span class="n">build</span><span class="o">-</span><span class="n">coverage</span> <span class="o">./</span><span class="n">elos</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">coverage</span><span class="o">/</span><span class="n">run_asmcov</span><span class="o">.</span><span class="n">sh</span> <span class="n">functionName</span> <span class="p">[</span><span class="n">otherFunctionName</span><span class="p">]</span> <span class="p">[</span><span class="n">compilationUnitName</span><span class="p">]</span>

<span class="c1">## only run the test for safuVecCreate</span>
<span class="n">BUILD_DIR</span><span class="o">=./</span><span class="n">build</span><span class="o">-</span><span class="n">coverage</span> <span class="o">./</span><span class="n">elos</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">coverage</span><span class="o">/</span><span class="n">run_asmcov</span><span class="o">.</span><span class="n">sh</span> <span class="n">vecCreate</span>

<span class="c1">## only run the test for safuVecCreate and elosEventSerialize</span>
<span class="n">BUILD_DIR</span><span class="o">=./</span><span class="n">build</span><span class="o">-</span><span class="n">coverage</span> <span class="o">./</span><span class="n">elos</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">coverage</span><span class="o">/</span><span class="n">run_asmcov</span><span class="o">.</span><span class="n">sh</span> <span class="n">vecCreate</span> <span class="n">eventSerialize</span>

<span class="c1">## only run the all tests for the compilation unit vector.c</span>
<span class="n">BUILD_DIR</span><span class="o">=./</span><span class="n">build</span><span class="o">-</span><span class="n">coverage</span> <span class="o">./</span><span class="n">elos</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">coverage</span><span class="o">/</span><span class="n">run_asmcov</span><span class="o">.</span><span class="n">sh</span> <span class="n">vector</span>

<span class="c1">## only run the all tests for the compilation unit vector.c and event.c</span>
<span class="n">BUILD_DIR</span><span class="o">=./</span><span class="n">build</span><span class="o">-</span><span class="n">coverage</span> <span class="o">./</span><span class="n">elos</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">coverage</span><span class="o">/</span><span class="n">run_asmcov</span><span class="o">.</span><span class="n">sh</span> <span class="n">vector</span> <span class="n">event</span>

<span class="c1">## run all test that match the pattern `test_*_utest` and located in elos/build/${BUILD_TYPE}/cmake/test/utest</span>
<span class="n">BUILD_DIR</span><span class="o">=./</span><span class="n">build</span><span class="o">-</span><span class="n">coverage</span> <span class="o">./</span><span class="n">elos</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">coverage</span><span class="o">/</span><span class="n">run_asmcov</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>The results can be found in <code class="docutils literal notranslate"><span class="pre">elos/build/${BUILD_TYPE}/coverage_results</span></code></p>
<p>To use a custom install location of asmcov set <code class="docutils literal notranslate"><span class="pre">ASMCOV_DIR</span></code> and point to the
location where the asmcov binaries are installed.</p>
</section>
</section>
</section>
<section id="smoke-tests-test-smoketest">
<h3>Smoke Tests test/smoketest<a class="headerlink" href="#smoke-tests-test-smoketest" title="Link to this heading">¶</a></h3>
<p>Goal:</p>
<p>Smoke tests are quick to execute and they give a brief overview about the basic functionality. Smoke tests try to answer: Is the software still basically OK? Or does it crash right away?</p>
<p>The CI system is responsible of running the smoke tests regularly.</p>
<p>Details:</p>
<ul class="simple">
<li><p>Runs all composed artifacts to ensure a basic expected functionality</p></li>
<li><p>Make usage of the demo project to check expected behavior of elosd</p></li>
<li><p>Executed by CI-pipeline</p></li>
<li><p>Written in pure Bash</p></li>
</ul>
<section id="how-to-run-the-smoke-test-from-git-project-root">
<h4>how to run the smoke test from git project root:<a class="headerlink" href="#how-to-run-the-smoke-test-from-git-project-root" title="Link to this heading">¶</a></h4>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>./elos/ci/build.sh<span class="w"> </span><span class="o">[</span>Release<span class="o">]</span>
</pre></div>
</div>
<ul class="simple">
<li><p>call <code class="docutils literal notranslate"><span class="pre">./elos/ci/run_smoketests.sh</span></code> to run the smoketests for the debug build</p></li>
<li><p>call <code class="docutils literal notranslate"><span class="pre">./elos/ci/run_smoketests.sh</span> <span class="pre">Release</span></code> to run the smoketests for the release build</p></li>
</ul>
</section>
<section id="run-on-a-target">
<h4>Run on a target<a class="headerlink" href="#run-on-a-target" title="Link to this heading">¶</a></h4>
<p>To run the smoketest install all content in <code class="docutils literal notranslate"><span class="pre">elos/tests/smoketest</span></code> to a custom
location on the target system. Currently it is not packaged and installed by
elos build system itself.</p>
<section id="prerequisites">
<h5>Prerequisites :<a class="headerlink" href="#prerequisites" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p>Elos is installed on target system</p></li>
<li><p>At least a writeable directory to store results and for intermediate files</p></li>
</ul>
</section>
<section id="howto">
<h5>HOWTO<a class="headerlink" href="#howto" title="Link to this heading">¶</a></h5>
<p>To execute the smoketests run the installed smoketest.sh script. Here an example
script to for smoketest integration (taken form baseos-lab)</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh -xe</span>

<span class="nb">export</span><span class="w"> </span><span class="nv">ELOS_SCANNER_PATH</span><span class="o">=</span>/usr/lib/elos/scanner
<span class="nb">export</span><span class="w"> </span><span class="nv">ELOS_BACKEND_PATH</span><span class="o">=</span>/usr/lib/elos/backend
<span class="nb">export</span><span class="w"> </span><span class="nv">SMOKETEST_DIR</span><span class="o">=</span>/usr/lib/test/baseos-elos/smoketest/
<span class="nb">export</span><span class="w"> </span><span class="nv">SMOKETEST_RESULT_DIR</span><span class="o">=</span>/tmp/test-baseos-elos-smoketest


<span class="c1">## make sure to stop elosd instances before</span>

/usr/lib/test/baseos-elos/smoketest/smoketest.sh
</pre></div>
</div>
</section>
<section id="extended-configuration">
<h5>Extended configuration<a class="headerlink" href="#extended-configuration" title="Link to this heading">¶</a></h5>
<p>Depending on the installation and configuration it could be necessary to adjust
some settings. The following Environment variables can be used :</p>
<ul class="simple">
<li><p>Use LD_LIBRARY_PATH to include custom locations for elos libraries.:</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">LD_LIBRARY_PATH=${LD_LIBRARY_PATH}:/some/location</span></code></p>
<p>default is : elos/build/${BUILD_TYPE}/dist/usr/local/lib</p>
<ul class="simple">
<li><p>Use PATH to include custom locations for elos</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">PATH=${PATH}:/some/location</span></code></p>
<p>default is: ${PATH}:${DIST_DIR}/usr/local/bin”</p>
<ul class="simple">
<li><p>Use SMOKETEST_DIR to point to the location where elos-smoketests are installed</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">SMOKETEST_DIR=/some/location</span></code></p>
<p>default is : elos/test/smoketest/</p>
<ul class="simple">
<li><p>Use SMOKETEST_RESULT_DIR to define where to store smoke tests results</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">SMOKETEST_RESULT_DIR=/some/write/able/location</span></code></p>
<p>default is : “elos/build/${BUILD_TYPE}/result/smoketest_results”</p>
<ul class="simple">
<li><p>Use SMOKETEST_TMP_DIR to define where to store intermediate results and or runtime files like sockets, pipes etc.</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">SMOKETEST_TMP_DIR=/some/write/able/location</span></code></p>
<p>default is: “/tmp/elosd”</p>
<ul class="simple">
<li><p>Use ELOS_SYSLOG_PATH to define an alternative location for the syslog unix domain socket</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">ELOS_SYSLOG_PATH=/some/write/able/location/mysyslog.socket</span></code></p>
<p>default is: <code class="docutils literal notranslate"><span class="pre">${SMOKETEST_TMP_DIR}/elosd.syslog.socket</span></code></p>
<ul class="simple">
<li><p>Use ELOS_KMSG_PATH to define an alternative location for the kmsg file</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">ELOS_KMSG_FILE=/some/write/able/location/my_dev_kmsg</span></code></p>
<p>default is: ${SMOKETEST_TMP_DIR}/elosd.kmsg”</p>
<ul class="simple">
<li><p>Use ELOS_SCANNER_PATH to define where elos shall look for scanner plugins (<code class="docutils literal notranslate"><span class="pre">\*.so</span></code> files)</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">ELOS_SCANNER_PATH=/some/location</span></code></p>
<p>default is: <code class="docutils literal notranslate"><span class="pre">$DIST_DIR/usr/local/lib/elos/scanner</span></code></p>
<ul class="simple">
<li><p>Use ELOS_BACKEND_PATH to define where elos shall look for backend plusings (<code class="docutils literal notranslate"><span class="pre">\*.so</span></code> files)</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">ELOS_BACKEND_PATH=/some/location</span></code></p>
<p>default is: <code class="docutils literal notranslate"><span class="pre">$DIST_DIR/usr/local/lib/elos/backend</span></code></p>
<ul class="simple">
<li><p>Use ELOS_CONFIG_PATH to define where the elosd configuration is stored.</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">ELOS_CONFIG_PATH=/a/readable/elosd/json/configuration</span></code></p>
<p>default is: <code class="docutils literal notranslate"><span class="pre">$SMOKETEST_DIR/config.json</span></code></p>
<p>For the purpose of the smoketests, the elosd config is mostly relevant to configure the storage location of the backend and scanner plugins.</p>
</section>
</section>
</section>
<section id="integration-test">
<h3>Integration Test<a class="headerlink" href="#integration-test" title="Link to this heading">¶</a></h3>
<p>Goal:</p>
<p>Integration tests verify that the software fulfills all requirements in the final environment.</p>
<p>Integration tests shall be done before release of a new version.</p>
<p>Details:</p>
<ul class="simple">
<li><p>Integration Tests account for testing usecases that are not covered by smoketests or unittests and ensure elosd
works as expected.</p></li>
<li><p>Tests need to be target agnostic and therefore are packaged as separate elos-integration-test package.</p></li>
<li><p>Robot test framework is used to create integration tests</p></li>
<li><p>integration tests shall make use of the  sanitizers</p></li>
</ul>
<section id="components">
<h4>Components<a class="headerlink" href="#components" title="Link to this heading">¶</a></h4>
<p>The fundamental components required for integration tests are as given below, apart from these, additional components are added according to test environment.</p>
<ul class="simple">
<li><p>Robot test framework</p>
<ul>
<li><p><a class="reference external" href="https://robotframework.org/robotframework/latest/RobotFrameworkUserGuide.html">Robot Framework</a> is a test automation framework.</p></li>
<li><p>Integration tests are written with the help of Robot test framework.</p></li>
<li><p>Robocop</p>
<ul>
<li><p><a class="reference external" href="https://robocop.readthedocs.io/en/stable/">Robocop</a> static code analyser for robot framework</p></li>
<li><p>Tests written with robotframework are statically analysed using robocop tool</p></li>
</ul>
</li>
<li><p>Robotidy</p>
<ul>
<li><p><a class="reference external" href="https://robotidy.readthedocs.io/en/stable/index.html">Robotidy</a> code linter for robot framework</p></li>
<li><p>code linter for tests written in robot framework</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Integration test package</p>
<ul>
<li><p>A test directory has one or more tests written in robot as well as sub directories containing tests</p></li>
<li><p>The integration test can be found in <code class="docutils literal notranslate"><span class="pre">test/integration</span></code></p></li>
<li><p>Elos integration test package consists of all tests in the integration directory</p></li>
</ul>
</li>
<li><p>Test targets</p>
<ul>
<li><p>The target has elosd installed and running when integration tests are executed. They could be</p>
<ul>
<li><p>Container</p></li>
<li><p>Qemu hardware emulator</p></li>
<li><p>Client hardware</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</section>
<section id="setup">
<h4>Setup<a class="headerlink" href="#setup" title="Link to this heading">¶</a></h4>
<section id="integration-test-setup-for-elos-ci">
<h5>Integration test setup for elos CI<a class="headerlink" href="#integration-test-setup-for-elos-ci" title="Link to this heading">¶</a></h5>
<p><img alt="Integration Test Setup" src="../_images/integration_test_container_target_setup.png" /></p>
<ul class="simple">
<li><p>The host system has the elos-integration-test packages and a test-runner script.</p></li>
<li><p>The robot container where  the robot test framework is installed. The test package directory is mounted on to this container.</p></li>
<li><p>The elos container where elosd is installed and running serves as the target.</p></li>
<li><p>The test results are stored in <code class="docutils literal notranslate"><span class="pre">build/[Debug|Release]/result/integration</span></code></p></li>
</ul>
<p>New tests are added directly in the elos-integration-test package. Starting the container with robot framework installed, mounts the test-package automatically. The test runner script is found in <code class="docutils literal notranslate"><span class="pre">integration/scripts</span></code>. The target container should be started before running the test runner script. Starting the target container installs elosd from source and runs it. The test-runner script requires the target credentials like username, password and target ip address in order to run the tests.</p>
</section>
<section id="integration-test-setup-for-base-os-lab-ci">
<h5>Integration test setup for Base OS Lab CI<a class="headerlink" href="#integration-test-setup-for-base-os-lab-ci" title="Link to this heading">¶</a></h5>
<p><img alt="Integration Test BaseOS Lab Setup " src="../_images/integration_test_baseos-lab_setup.png" /></p>
<ul class="simple">
<li><p>The host base-os lab has the following components :</p>
<ul>
<li><p>elos-integration-package</p></li>
<li><p>Robot framework</p></li>
<li><p>Labgrid</p></li>
<li><p>Pytest Runner plugin for Labgrid</p></li>
</ul>
</li>
<li><p>An hardware emulator (QEMU) or the client hardware will be used as the target.</p></li>
<li><p>Test results will be stored in <code class="docutils literal notranslate"><span class="pre">&amp;lt;&amp;lt;test_image&amp;gt;&amp;gt;/report</span></code></p></li>
</ul>
<p>The host in base os lab is a container with the robot framework, labgrid and pytest plugin for labgrid installed. The elos-integration-test package is retrieved from elos-tools repository. Labgrid establishes connection with the target which could be a client hardware or qemu image. Upon establishing connection, target information like ip address is retrieved for use by integration tests . The pytest runner plugin is used to run ptests in the target. The call to run robot integration tests is encapsulated in a new test. The test run scripts when called, build and boots the target and runs the test and stores the reult in the host system.</p>
</section>
</section>
<section id="id1">
<h4>Usage<a class="headerlink" href="#id1" title="Link to this heading">¶</a></h4>
<p>The integration tests can be run by calling:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">elos</span>
<span class="o">./</span><span class="n">ci</span><span class="o">/</span><span class="n">run_integration_tests</span><span class="o">.</span><span class="n">sh</span> <span class="p">[</span><span class="n">Release</span><span class="p">]</span>   <span class="c1"># run integration tests automatically</span>
</pre></div>
</div>
<p>This will start two docker containers and execute the tests.</p>
<p>The results will be stored in <code class="docutils literal notranslate"><span class="pre">build/[Debug|Release]/result/integration</span></code>.</p>
<p>In order to manually run the integration tests in the local repository</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">elos</span>
<span class="o">./</span><span class="n">ci</span><span class="o">/</span><span class="n">docker</span><span class="o">-</span><span class="n">target</span><span class="o">-</span><span class="n">run</span><span class="o">.</span><span class="n">sh</span>    <span class="c1"># start target container in a terminal</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">elos</span>
<span class="o">./</span><span class="n">ci</span><span class="o">/</span><span class="n">docker</span><span class="o">-</span><span class="n">integration</span><span class="o">-</span><span class="n">run</span><span class="o">.</span><span class="n">sh</span>    <span class="c1"># start test container in a separate terminal</span>
<span class="n">PROJECT</span><span class="o">=</span><span class="s2">&quot;elos&quot;</span> <span class="o">./</span><span class="n">scripts</span><span class="o">/</span><span class="n">run_integration_tests</span><span class="o">.</span><span class="n">sh</span>    <span class="c1"># inside the container set project variable and run the test runner script</span>
</pre></div>
</div>
<p>When doing this, the result storage path can be configured by setting the enviroment variable
<code class="docutils literal notranslate"><span class="pre">TEST_OUTPUT</span></code> for the <code class="docutils literal notranslate"><span class="pre">run_inetgration_tests.sh</span></code> script.</p>
<section id="ci-integration">
<h5>CI integration<a class="headerlink" href="#ci-integration" title="Link to this heading">¶</a></h5>
<p>The ./ci/docker-integration-run.sh can be used to run in some CI environment,
however to ensure that used docker container and image names are uniwue and not
interfer with different parallel runs of these test suite the follwoing
variabeles shall be set.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">CI</span><span class="o">=</span><span class="s2">&quot;true&quot;</span>
<span class="nv">BUILD_ID</span><span class="o">=</span><span class="s2">&quot;42&quot;</span>
<span class="nv">GIT_COMMIT</span><span class="o">=</span><span class="s2">&quot;0000000000000000000000000000000000000000&quot;</span>
</pre></div>
</div>
<p>These will be used to generate unique docker-container and image names. The
pattern look like <code class="docutils literal notranslate"><span class="pre">${ELOSD_IMAGE_NAME}-${BUILD_ID}-${GIT_COMMIT}</span></code>.</p>
</section>
<section id="yocto-baseos-lab-integration">
<h5>(yocto-) baseos-lab integration<a class="headerlink" href="#yocto-baseos-lab-integration" title="Link to this heading">¶</a></h5>
<p>To manually run the test in base os lab</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">eb</span><span class="o">-</span><span class="n">baseos</span><span class="o">-</span><span class="n">lab</span>
<span class="o">./</span><span class="n">ci</span><span class="o">/</span><span class="n">docker</span><span class="o">-</span><span class="n">run</span><span class="o">.</span><span class="n">sh</span>                     <span class="c1"># start host container</span>
                                       <span class="c1"># Inside container</span>
<span class="o">./</span><span class="n">ci</span><span class="o">/</span><span class="n">repo</span><span class="o">-</span><span class="n">init</span><span class="o">.</span><span class="n">sh</span>                      <span class="c1"># initialize submodule</span>
<span class="o">./</span><span class="n">ci</span><span class="o">/</span><span class="n">build</span><span class="o">.</span><span class="n">sh</span>                          <span class="c1"># build target image  **note** - the previous step and this step needs to be run at least once before test run</span>
<span class="o">./</span><span class="n">ci</span><span class="o">/</span><span class="n">qemu</span><span class="o">-</span><span class="n">test</span><span class="o">.</span><span class="n">sh</span> <span class="o">-</span><span class="n">i</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">image_name</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span>    <span class="c1"># build and boot given qemu image and run integration tests on it.</span>
                                       <span class="c1"># To test on all images use --build-all and no image name instead of -i</span>
</pre></div>
</div>
</section>
</section>
<section id="writing-a-robot-test">
<h4>Writing a Robot Test<a class="headerlink" href="#writing-a-robot-test" title="Link to this heading">¶</a></h4>
<p>The directory structure for integration test is as show below.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>elos
├──<span class="w"> </span><span class="nb">test</span>
<span class="w">    </span>├──<span class="w"> </span>integration
<span class="w">        </span>├──<span class="w"> </span>testmodule
<span class="w">            </span>├──<span class="w"> </span>test.robot
<span class="w">            </span>├──<span class="w"> </span>subtestmodule
<span class="w">                </span>├──<span class="w"> </span>subtest.robot
</pre></div>
</div>
<p>New test suites are added to <code class="docutils literal notranslate"><span class="pre">elos/test/integration</span></code>.</p>
<section id="coding-guidelines">
<h5>Coding Guidelines<a class="headerlink" href="#coding-guidelines" title="Link to this heading">¶</a></h5>
<p>The coding guidelines for robot static code analysis are as given in <code class="docutils literal notranslate"><span class="pre">elos/test/integartion/scripts/robot_linter_config.txt</span></code>. The
guide lines are quite liberal as default and can be further restricted depending on the user requirements. The default guidelines are
as follows:</p>
<ul class="simple">
<li><p>The length of a robot keyword is set to 50</p></li>
<li><p>A keyword can call a maximum of 20 other keywords inside it.</p></li>
<li><p>Since template test cases dont have keywords, check for too few calls to keywords shall be avoided.</p></li>
<li><p>Line width for robot tests are set to 100</p></li>
<li><p>static checks shall only report log levels of above warning.</p></li>
</ul>
</section>
<section id="step-by-step-guide-to-create-and-run-integration-test">
<h5>Step by step guide to create and run integration test<a class="headerlink" href="#step-by-step-guide-to-create-and-run-integration-test" title="Link to this heading">¶</a></h5>
<p>An example of a robot test is given below :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>*** Settings ***
Documentation      ssh test script
Library            SSHLibrary

*** Variables ***
${host}            192.168.7.1    # replace with target under test (TUT) ip
${username}        root           # replace with TUT  username
${password}        ${EMPTY}       # replace with TUT  password
${alias}           target         # use any appropriate alias for target
${hostname}        qemu-64        # replace with TUT  hostname

*** Test Cases ***
Test SSH Connection
    Open Connection     ${host}        alias=${alias}
    Login               ${username}    ${password}    delay=1
    ${output}=    Is Connected
    Should Be Equal As String    ${output}    ${hostname}
    Close All Connections

*** Keywords ***
Is Connected
    ${value}=         Execute Command    hostname
    RETURN    ${value}
</pre></div>
</div>
<ol class="arabic simple">
<li><p>Create file <code class="docutils literal notranslate"><span class="pre">new_test_suite.robot</span></code> file under <code class="docutils literal notranslate"><span class="pre">elos/test/integration/new_module</span></code>.</p></li>
<li><p>Copy the above code into <code class="docutils literal notranslate"><span class="pre">new_test_suite.robot</span></code></p></li>
<li><p>Change test variables to target under test (TUT) values.</p></li>
<li><p>To run test start target elosd container by <code class="docutils literal notranslate"><span class="pre">./elos/ci/docker-target-run.sh</span></code> first.</p></li>
<li><p>In a separate terminal start robot container by <code class="docutils literal notranslate"><span class="pre">./elos/ci/docker-integration-run.sh</span></code></p></li>
<li><p>Inside the robot container run all tests using script <code class="docutils literal notranslate"><span class="pre">PROJECT=&quot;elos&quot;</span> <span class="pre">./scripts/run-integration-tests.sh</span></code></p></li>
<li><p>The test results are stored in <code class="docutils literal notranslate"><span class="pre">report/new_module</span></code></p></li>
<li><p>In order to run individual test use</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>robot<span class="w"> </span>--outputdir<span class="o">=</span>report/new_module<span class="w"> </span>--output<span class="o">=</span>new_test_suite<span class="w"> </span>--report<span class="o">=</span>new_test_suite<span class="w"> </span>new_test_suite
<span class="c1">## In order to run only a testcase from the test suite</span>
robot<span class="w"> </span>-t<span class="w"> </span>test_case_name<span class="w"> </span>--outputdir<span class="o">=</span>report/new_module<span class="w"> </span>--output<span class="o">=</span>test_case_name<span class="w"> </span>--report<span class="o">=</span>test_case_name<span class="w"> </span>new_test_suite
</pre></div>
</div>
</section>
<section id="robot-test-explanation">
<h5>Robot Test Explanation<a class="headerlink" href="#robot-test-explanation" title="Link to this heading">¶</a></h5>
<p>In Robot Framework, each robot file is a test suite. Likewise, a directory containing .robot files is a master test suite. Unless Robot Framework is given with a single robot file to execute, it wil try to look for robot files recursively. Spaces in filename should be replaced by an underscore.</p>
<p>This test checks ssh connection to a target whose ip, username and password is known. The test script is divided into 4 sections.</p>
<ul class="simple">
<li><p>Settings - The required test settings with the keywords</p>
<ul>
<li><p>The Documentation keyword is a simple test description text</p></li>
<li><p>The Library keyword imports keywords from given argument. The argument for this keyword is SSHLibrary,
which has keywords for a ssh interaction with given target.</p></li>
<li><p>More keyword under settings is found here <a class="reference external" href="https://robotframework.org/robotframework/latest/RobotFrameworkUserGuide.html#settings-in-the-test-case-section">Additional Settings Keywords</a></p></li>
</ul>
</li>
<li><p>Variables - The variables to be used in this test</p>
<ul>
<li><p>The variables created in the variable section have a test suite scope.</p></li>
<li><p>All test cases inside a robot file can access it.</p></li>
<li><p>The variables have read write permission.</p></li>
<li><p>In order to over write a variable defined in the variable section, the <code class="docutils literal notranslate"><span class="pre">Set</span> <span class="pre">Test</span> <span class="pre">Variable</span></code> built in keyword can be used.</p></li>
</ul>
</li>
<li><p>Test case - The actual test case which is written in using available keywords and arguments.</p></li>
<li><p>Keywords  - Here keyword can be defined which shall be used in one or more testcases in the robot file.</p></li>
</ul>
<p>In test suits variables and keywords can be added to a *.resource file in order to share them. They are imported into tests that require them, using the resource keyword in the settings section as given below.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span> <span class="n">Settings</span> <span class="o">*</span>
<span class="n">Documentation</span>      <span class="n">ssh</span> <span class="n">test</span> <span class="n">script</span>
<span class="n">Resource</span>           <span class="n">keywords</span><span class="o">.</span><span class="n">resource</span>

</pre></div>
</div>
<p>Variables created in .resource files can be of type other than strings.</p>
</section>
<section id="robot-test-linter">
<h5>Robot Test Linter<a class="headerlink" href="#robot-test-linter" title="Link to this heading">¶</a></h5>
<p>The code check and linting of robot tests are done as follows:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>elos
./ci/run_integration_tests_linter.sh<span class="w"> </span><span class="o">[</span>Debug<span class="p">|</span>Release<span class="o">]</span>
</pre></div>
</div>
<p>This will start the <code class="docutils literal notranslate"><span class="pre">.test/integration/scripts/robot_code_lint.sh</span></code> script which will do a static code check on all integration tests.
The results will be stored in <code class="docutils literal notranslate"><span class="pre">build/[Debug|Release]/result/integration/robot_lint/robot_lint.log</span></code>, only when one or more of the tests fail the checks.</p>
<p>After analysing the results, the tests which fail can be fixed using the robotidy linter as geven below</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>./test/integration/scripts/robot_code_lint.sh<span class="w"> </span>--show
</pre></div>
</div>
<p>This will point out the format errors in the given test.robot and gives suggestions to fix them. If no test is specified all tests wil be checked
and suggestion will be shown.</p>
<p>If the fixes suggested are satifactory, then the fixes can be implemented by</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>./test/integration/scripts/robot_code_lint.sh<span class="w"> </span>--show-fix
</pre></div>
</div>
<p>This will show the suggested changes before writing them to the corresponding test/s.</p>
<p>For other options in the <code class="docutils literal notranslate"><span class="pre">robot_code_lint.sh</span></code> use</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>./test/integration/scripts/robot_code_lint.sh<span class="w"> </span>--help
</pre></div>
</div>
</section>
</section>
</section>
<section id="benchmarks">
<h3>Benchmarks<a class="headerlink" href="#benchmarks" title="Link to this heading">¶</a></h3>
<p>Goal:</p>
<p>Benchmarks record selected key performance indicators (KPI) that are relevant for the resource consumption and performance of the software.</p>
<p>Benchmarks shall be done before release of a new version.</p>
<p>Details:</p>
<ul class="simple">
<li><p>gives a general overview of how elosd performs</p></li>
<li><p>the benchmarks covers the following setups:
** 1 on 1 : 1 subscriber per 1 publisher for 1,2,5,10,100 subscribers and publishers
** 1 on n : n subscriber per 1 publisher for 1,2,5,10,100 subscribers and 1,2 publishers</p></li>
<li><p>the results can be found in build/benchmark_results
** report_&lt;messages&gt;<em>&lt;subscriber&gt;</em>&lt;publisher&gt;.csv containing the plain timestamps for (send,dispatched,received)
** report_&lt;messages&gt;<em>&lt;subscriber&gt;</em>&lt;publisher&gt;.csv.png a visualization of the csv-report files.</p></li>
<li><p>how to run the benchmarks from git project root:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cmake</span> <span class="o">-</span><span class="n">B</span> <span class="n">build</span> <span class="n">elos</span>
<span class="n">make</span> <span class="o">-</span><span class="n">C</span> <span class="n">build</span>
<span class="o">./</span><span class="n">elos</span><span class="o">/</span><span class="n">ci</span><span class="o">/</span><span class="n">run_benchmarks</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<section id="profiling">
<h4>Profiling<a class="headerlink" href="#profiling" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p>gives a insides on how elosd spends its time during execution</p></li>
<li><p>for profiling perf is used</p></li>
<li><p>the results can be found in build-perf/perf_results/&lt;timestamp&gt;
** perf.data is the raw output from perf
** perf_output.txt contains profiling info from perf.data in text form</p></li>
<li><p>how to run the benchmarks from git project root:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">./</span><span class="n">elos</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">profiling</span>
<span class="n">sudo</span> <span class="o">./</span><span class="n">perf</span><span class="o">.</span><span class="n">sh</span> <span class="n">setcap</span>        <span class="c1"># Allow profiling without root rights</span>
<span class="o">./</span><span class="n">perf</span><span class="o">.</span><span class="n">sh</span> <span class="n">clean</span>              <span class="c1"># Removes build and profiling files</span>
<span class="o">./</span><span class="n">perf</span><span class="o">.</span><span class="n">sh</span> <span class="n">build</span>              <span class="c1"># Build the project with the profiling flag</span>
<span class="o">./</span><span class="n">perf</span><span class="o">.</span><span class="n">sh</span> <span class="n">elosd</span>              <span class="c1"># Monitor elosd and store the results</span>
<span class="o">./</span><span class="n">perf</span><span class="o">.</span><span class="n">sh</span> <span class="n">hotspot</span>            <span class="c1"># Call the &#39;hotspot&#39; tool with the latest profiling data set</span>
<span class="n">sudo</span> <span class="o">./</span><span class="n">perf</span><span class="o">.</span><span class="n">sh</span> <span class="n">restorecap</span>    <span class="c1"># Restores old capability value</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="sanitizers">
<h2>Sanitizers<a class="headerlink" href="#sanitizers" title="Link to this heading">¶</a></h2>
<p>Goal:</p>
<p>During testing (utest, smoketest, integration tests) some self checking sanitizers shall be used to detect unwanted behavior.</p>
<section id="address-sanitizer">
<h3>Address Sanitizer<a class="headerlink" href="#address-sanitizer" title="Link to this heading">¶</a></h3>
<p>Only the ‘Debug’ target build comes with the Address Sanitizer enabled</p>
<ul class="simple">
<li><p>to find common memory access/management failures the project is build on default (Debug) with GCC’s Address Sanitizer enabled</p></li>
<li><p>the Release target is guaranteed to come without sanitizers in case you want to use other tools like Valgrind (build with <code class="docutils literal notranslate"><span class="pre">cmake</span> <span class="pre">-DCMAKE_BUILD_TYPE=Release</span></code>)</p></li>
<li><p>sanitizers shall be used in unit- and integration-tests.</p></li>
</ul>
</section>
<section id="thread-sanitizer">
<h3>Thread Sanitizer<a class="headerlink" href="#thread-sanitizer" title="Link to this heading">¶</a></h3>
<p>Only the ‘Tsan’ target build comes with the Thread Sanitizer enabled</p>
<ul class="simple">
<li><p>Can be used to find data races, erronous mutex accesses and other multi-threading related problems.</p></li>
<li><p>Can be built with  <code class="docutils literal notranslate"><span class="pre">./ci/build.sh</span> <span class="pre">Tsan</span></code> or configured with <code class="docutils literal notranslate"><span class="pre">cmake</span> <span class="pre">-DCMAKE_BUILD_TYPE=Tsan</span></code>.</p></li>
<li><p>Has its own build target due to it being incompatible with other sanitizers like ASAN and Valgrind.</p></li>
<li><p>Currently not part of the CI pipeline as we still evaluate its usefulness.</p></li>
</ul>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/elos_blue.png" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../index.html">elos</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../doc/userManual.html">Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="../src/demos/index.html">Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../build/Debug/doc/source_generated/api/index.html">public API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../src/index.html">Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../build/Debug/doc/source_generated/developer/api/index.html">Complete API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc/Architecture_Design_Records/index.html">ADRs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc/index.html">How we document</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Verification Strategy or how we test</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#coding-guideline">Coding Guideline</a></li>
<li class="toctree-l2"><a class="reference internal" href="#development-process">Development process</a></li>
<li class="toctree-l2"><a class="reference internal" href="#static-analysis">Static analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="#testing">Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sanitizers">Sanitizers</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="../doc/index.html" title="previous chapter">The project documentation</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, wolfgang.gehrhardt@emlix.com.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.2.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../_sources/test/index.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>