// SPDX-License-Identifier: MIT

#include <bits/types/struct_iovec.h>
#include <safu/defines.h>
#include <safu/result.h>

#include "elosDltReadData_utest.h"

int elosTestElosDltReadDataErrorInvalidMsgSetup(UNUSED void **state) {
    return 0;
}

int elosTestElosDltReadDataErrorInvalidMsgTeardown(UNUSED void **state) {
    return 0;
}

void elosTestElosDltReadDataErrorInvalidMsg(UNUSED void **state) {
    safuResultE_t result;
    elosDltParseResultE_t testParResult = ELOS_DLT_RESULT_OK;
    elosDltData_t testDltData = {0};
    unsigned char testBuffer[] = {
        0xf1, 0xec, 0x67, 0xb8, 0x2e, 0x4,  0x0,  0x45, 0x43, 0x55, 0x0,  0x3e, 0x1,  0x0,  0xa4, 0x43, 0x30, 0x30,
        0x32, 0x0,  0x0,  0x0,  0x5a, 0x3b, 0xaa, 0x6,  0xb5, 0x0,  0x0,  0x0,  0x0,  0x5b, 0x36, 0x31, 0x5d, 0x2d,
        0x5b, 0x42, 0x4d, 0x61, 0x6e, 0x20, 0x5d, 0x2d, 0x5b, 0x49, 0x4e, 0x46, 0x4f, 0x3a, 0x20, 0x20, 0x20, 0x28,
        0x49, 0x50, 0x4c, 0x31, 0x29, 0x20, 0x53, 0x74, 0x61, 0x72, 0x74, 0x20, 0x49, 0x50, 0x4c, 0x31, 0x20, 0x46,
        0x57, 0x20, 0x31, 0x2e, 0x33, 0x38, 0x2e, 0x30, 0x20, 0x70, 0x72, 0x6f, 0x6a, 0x65, 0x63, 0x74, 0x20, 0x76,
        0x65, 0x72, 0x73, 0x69, 0x6f, 0x6e, 0x3a, 0x20, 0x33, 0x2e, 0x35, 0x37, 0x2e, 0x30, 0x2d, 0x69, 0x63, 0x61,
        0x73, 0x31, 0x2e, 0x67, 0x65, 0x6e, 0x32, 0xa,  0xda, 0xd8, 0xf8, 0xbd, 0x6b, 0xda, 0x98, 0x39, 0xa9, 0x1f,
        0xf9, 0xd3, 0x53, 0x91, 0xa,  0xb6, 0xfa, 0xf5, 0x1e, 0xaf, 0xc0, 0x9a, 0x7f, 0x4,  0xf8, 0xa2, 0xbf, 0x6a,
        0x75, 0xdf, 0x97, 0xed, 0xa4, 0xcf, 0x6b, 0x6a, 0x8e, 0x6d, 0x9a, 0x83, 0x56, 0xe2, 0x74, 0x15, 0x74, 0x5e,
        0x99, 0x5e, 0xbd, 0xdd, 0xc4, 0x46, 0xcc, 0xc0, 0xda, 0x40, 0x0,  0x5d, 0x0};

    size_t testBufferSize = ARRAY_SIZE(testBuffer);

    TEST("elosDltReadData");
    SHOULD("%s", "throw invalid dlt message error");

    result = elosDltReadData(testBuffer, testBufferSize, &testParResult, &testDltData);
    assert_int_equal(testParResult, ELOS_DLT_INVALID_DLT_MSG);
    assert_int_equal(result, SAFU_RESULT_FAILED);
    assert_int_equal(testDltData.dltDataSize.dataSize, 0);
}
