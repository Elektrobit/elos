<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="../_static/favicon_16x16.png" sizes="16x11" rel="icon" type="image/png">
    <link href="../_static/favicon_32x32.png" sizes="32x21" rel="icon" type="image/png">
    <title>elos - Flexible event logging and management with normalized output-format for linux &#8212; elos  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=4f649999" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=039e1c02" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="elos-flexible-event-logging-and-management-with-normalized-output-format-for-linux">
<h1>elos - Flexible event logging and management with normalized output-format for linux<a class="headerlink" href="#elos-flexible-event-logging-and-management-with-normalized-output-format-for-linux" title="Link to this heading">¶</a></h1>
<p>Event-driven architectures (EDA <a class="footnote-reference brackets" href="#id9" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>) assume that everything can be
hooked to events and only when the event occurs actions are started.</p>
<p>There are numerous benefits of EDA:</p>
<ul class="simple">
<li><p>Limited computer resources are shared over an enormous number of
events and handlers that only work if needed and do not waste compute
resources for polling</p></li>
<li><p>Already existing architectures of FOSS components assume an EDA</p></li>
<li><p>Foundation of a micro-service architecture is set-up</p></li>
</ul>
<p>In a Linux environment, such architectures find a natural habitat and
many FOSS-components are available to support.</p>
<p>The Linux kernel for example, has many interfaces that can be used to be
notified of important events. The same is true for startup systems and
network attached frameworks such as MQTT.</p>
<p>When looking at these different systems, it becomes clear that each has
its own understanding of events, their arguments and the interface used
to retrieve and send out events.</p>
<p>elos supports design of EDAs by handling events of any kind with
structured and configurable solutions.</p>
<aside class="topic">
<p class="topic-title">Types of generic operating-system-near events:</p>
<ul class="simple">
<li><p>simple events: startup/shutdown/config-change</p></li>
<li><p>seldom events: update-processes, reset, factory-reset</p></li>
<li><p>hardware events: high temperature, error of hardware</p></li>
<li><p>critical events: hardware failure occurred, failed selftest</p></li>
<li><p>debug events: out of memory, cpu overload</p></li>
<li><p>security events: failed log-ins, replacement of credentials</p></li>
</ul>
<p>All above events have a very heterogeneous format and way of handling.</p>
<p>elos helps in overcoming this, using a canonical event format.</p>
</aside>
<div class="line-block" id="section-1">
<div class="line">We begin with an example use case:</div>
<div class="line"><strong>Requirement:</strong> The client-application shall be started after the
server-application has finished its initialization.</div>
<div class="line">Questions to be answered in detailed design:</div>
</div>
<ul class="simple">
<li><p>Which event is the right start-signal to start the client?</p>
<ul>
<li><p>when port is open?</p></li>
<li><p>when process is there?</p></li>
<li><p>when a specific log line is written?</p></li>
<li><p>when process sends a signal?</p></li>
</ul>
</li>
</ul>
<p>All these events are valid to be used as a trigger event for the
client-start.</p>
<p>But they are challenging to implement and maintain</p>
<ul class="simple">
<li><p>What happens if the port changes?</p></li>
<li><p>What happens if the log isn’t printed any longer?</p></li>
<li><p>What happens if the handler needs to be extended?</p></li>
</ul>
<p>All of the above questions can be answered by writing a script that
checks for <em>xyz</em> every 5s and than does <em>zyx</em> but that is neither
efficient nor quick, and far from maintainable.</p>
<p>elos approaches this by splitting up and separating event detection,
event structure, event distribution, event filtering, event storage and
handling.</p>
<section id="elos-the-event-and-signal-funnel">
<h2>elos – the event and signal funnel<a class="headerlink" href="#elos-the-event-and-signal-funnel" title="Link to this heading">¶</a></h2>
<p><a class="reference internal" href="../_images/elos_2D_05.png"><img alt="image0" src="../_images/elos_2D_05.png" style="height: 35em;" /></a></p>
</section>
<section id="design">
<h2>design<a class="headerlink" href="#design" title="Link to this heading">¶</a></h2>
<p>elos provides a clean separation in the flow of events:</p>
<ul class="simple">
<li><p>event producer</p></li>
<li><p>event distribution and filtering</p></li>
<li><p>event receiving and handling</p></li>
<li><p>event logging to storage</p></li>
</ul>
<p>Events from many different sources are collected by elos or can be
provided to elos for verification. elos takes all of these events and
funnels them to handlers that are interested in that specific event.</p>
<p>elos takes any line printed to syslog or kernel log as a potential event
and is even able to react on ‘silent’ events that only cause a line in a
log to be printed with no further activities.</p>
<p>In the given server client example, the producer side needs to be
modified in case the port number changes. The event itself stays
unmodified and no event receiver will experience any change.</p>
</section>
<section id="basic-architecture-of-elos">
<h2>basic architecture of elos<a class="headerlink" href="#basic-architecture-of-elos" title="Link to this heading">¶</a></h2>
<p><a class="reference internal" href="../_images/image2.png"><img alt="image1" src="../_images/image2.png" style="width: 6.25417in; height: 4.69861in;" /></a></p>
<p>elos accepts events from any process using the C API provided by the
libelos library to send events via Inter Process Communication (IPC)
channels. In case libelos cannot be used, the protocol can also be
implemented directly.</p>
<p>The events undergo a first filter-stage to ensure the sender is only
sending events it is allowed to send with a defined and configurable
maximum rate.</p>
<div class="line-block">
<div class="line">Alternatively, elos can itself “scan” for events in the system. This
is accomplished by a module loaded to the elos process. Such scanners
are used to scan the system log and kernel log for events.</div>
<div class="line">The inner event distribution engine of elos forwards the events to the
potential subscribers and the logging subsystem.</div>
</div>
<p>Depending on the filter configuration, the event is then delivered. The
subscriber receives the event and can further analyze, process and react
to it as needed.</p>
<p>The same filtering technique is used to select the storage of each
event. Depending on the filter-setting, the event is stored in the
respective storage system either permanently or until the next reboot.
The maximum retention time and log size is configurable.</p>
</section>
<section id="event-format">
<h2>event format<a class="headerlink" href="#event-format" title="Link to this heading">¶</a></h2>
<p>To handle events efficiently, a unique format is needed. elos defines a
canonical format. The canonical format contains strongly and weakly
typed fields. Strongly typed fields have a strictly defined format
(usually integer) with a fixed elos-wide mapping of numbers and
semantics (e.g. a message code of 4004 always means that something
cannot be found, it is obviousely inspired by HTTP <a class="footnote-reference brackets" href="#id10" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a>). Weakly typed
fields can be freely filled by the sender with any kind of information
(usually JSON <a class="footnote-reference brackets" href="#id11" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a> encoded data structures). This mixture allows
flexibility and efficient generic filtering at the same time.</p>
<section id="canonical-format">
<h3>canonical format<a class="headerlink" href="#canonical-format" title="Link to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">date</span> <span class="p">:</span> <span class="n">timestamp</span> <span class="ow">in</span> <span class="n">nano</span> <span class="n">seconds</span> <span class="n">resolution</span>

<span class="n">source</span><span class="o">.</span><span class="n">appName</span> <span class="p">:</span> <span class="n">string</span>

<span class="n">source</span><span class="o">.</span><span class="n">fileName</span> <span class="p">:</span> <span class="n">string</span>

<span class="n">source</span><span class="o">.</span><span class="n">pid</span> <span class="p">:</span> <span class="nb">int</span>

<span class="n">severity</span> <span class="p">:</span> <span class="nb">int</span>

<span class="n">hardwareid</span> <span class="p">:</span> <span class="n">string</span>

<span class="n">message</span> <span class="n">code</span> <span class="p">:</span> <span class="nb">int</span> <span class="p">(</span><span class="n">inspired</span> <span class="n">by</span> <span class="n">http</span><span class="p">)</span>

<span class="n">classification</span> <span class="p">:</span> <span class="n">flags</span>

<span class="n">payload</span><span class="p">:</span> <span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">structs</span><span class="p">)</span>
</pre></div>
</div>
<p>The <em>payload</em> field has no specific type and can be used freely. The
<em>source</em> field contains - if applicable - the name and identities of the
emitting entity. If the kernel has sent the event, the pid will be set
to 0.</p>
<p>All other fields are strongly typed and need to be filled out
respectively.</p>
<p>The message code field has a predefined set of code inspired by HTTP
status codes but mapped to a wider range, hence 4004 means that a file
was not found.</p>
</section>
</section>
<section id="example-events">
<h2>Example events<a class="headerlink" href="#example-events" title="Link to this heading">¶</a></h2>
<p>Assuming an embedded in-vehicle environment, where typical Linux events
shall be processed:</p>
<section id="program-internal-error">
<h3>Program internal error<a class="headerlink" href="#program-internal-error" title="Link to this heading">¶</a></h3>
<p>In the case of a segmentation fault (SIGSEGV) from a process, a mail or
MQTT message is sent to some cloud service. The event might look like
this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">date</span> <span class="p">:</span> <span class="mi">123456</span>

<span class="n">source</span><span class="o">.</span><span class="n">appName</span> <span class="p">:</span> <span class="n">myApp</span>

<span class="n">source</span><span class="o">.</span><span class="n">fileName</span> <span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">myApp</span>

<span class="n">source</span><span class="o">.</span><span class="n">pid</span> <span class="p">:</span> <span class="mi">1234</span>

<span class="n">severity</span> <span class="p">:</span> <span class="mh">0x2</span> <span class="p">(</span><span class="o">=</span><span class="n">error</span><span class="p">)</span>

<span class="n">hardwareid</span> <span class="p">:</span> <span class="n">myMachine</span>

<span class="n">message</span> <span class="n">code</span> <span class="p">:</span> <span class="mi">5002</span>

<span class="n">classification</span> <span class="p">:</span> <span class="mh">0x20</span>

<span class="n">payload</span><span class="p">:</span>

<span class="p">{</span>

<span class="s2">&quot;function&quot;</span><span class="p">:</span><span class="s2">&quot;main&quot;</span><span class="p">,</span>

<span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="s2">&quot;0x12424f2&quot;</span><span class="p">,</span>

<span class="s2">&quot;...&quot;</span>

<span class="p">}</span>
</pre></div>
</div>
<p>The receiver of the event decodes the payload and might collect further
data from the ECU, the comprehensive data is then sent to e.g. a
cloud-instance.</p>
</section>
<section id="use-ssh-as-soon-as-possible">
<h3>Use ssh as soon as possible<a class="headerlink" href="#use-ssh-as-soon-as-possible" title="Link to this heading">¶</a></h3>
<p>It is required to start sshd as soon as a network is attached.</p>
<p>The event might look like this and was derived from networking kernel
interfaces:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">date</span> <span class="p">:</span> <span class="mi">123456</span>

<span class="n">source</span><span class="o">.</span><span class="n">appName</span> <span class="p">:</span> <span class="n">kernel</span>

<span class="n">source</span><span class="o">.</span><span class="n">fileName</span> <span class="p">:</span> <span class="o">-</span>

<span class="n">source</span><span class="o">.</span><span class="n">pid</span> <span class="p">:</span> <span class="mi">0</span>

<span class="n">severity</span> <span class="p">:</span> <span class="mh">0x04</span> <span class="p">(</span><span class="o">=</span><span class="n">info</span><span class="p">)</span>

<span class="n">hardwareid</span> <span class="p">:</span> <span class="n">myMachine</span>

<span class="n">message</span> <span class="n">code</span> <span class="p">:</span> <span class="mi">7003</span>

<span class="n">classification</span> <span class="p">:</span> <span class="mh">0x02</span>

<span class="n">payload</span><span class="p">:</span>

<span class="p">{</span>

<span class="s2">&quot;interface&quot;</span><span class="p">:</span> <span class="s2">&quot;eth0&quot;</span><span class="p">,</span>

<span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;plugged&quot;</span>

<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="open-debugging-interfaces-if-external-switch-was-pressed">
<h3>Open debugging interfaces if external switch was pressed<a class="headerlink" href="#open-debugging-interfaces-if-external-switch-was-pressed" title="Link to this heading">¶</a></h3>
<p>Start the debug service as soon as a general purpose input (GPIO) is
switched. The event might look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">date</span> <span class="p">:</span> <span class="mi">123456</span>

<span class="n">source</span><span class="o">.</span><span class="n">appName</span> <span class="p">:</span> <span class="n">kernel</span>

<span class="n">source</span><span class="o">.</span><span class="n">fileName</span> <span class="p">:</span> <span class="o">-</span>

<span class="n">source</span><span class="o">.</span><span class="n">pid</span> <span class="p">:</span> <span class="mi">0</span>

<span class="n">severity</span> <span class="p">:</span> <span class="mh">0x04</span> <span class="p">(</span><span class="o">=</span><span class="n">info</span><span class="p">)</span>

<span class="n">hardwareid</span> <span class="p">:</span> <span class="n">myMachine</span>

<span class="n">message</span> <span class="n">code</span> <span class="p">:</span> <span class="mi">7005</span>

<span class="n">classification</span> <span class="p">:</span> <span class="mh">0x80</span>

<span class="n">payload</span><span class="p">:</span>

<span class="p">{</span>

<span class="s2">&quot;interface&quot;</span><span class="p">:</span> <span class="s2">&quot;gpio23&quot;</span><span class="p">,</span>

<span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;raise&quot;</span>

<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="report-a-security-incident">
<h3>Report a security incident<a class="headerlink" href="#report-a-security-incident" title="Link to this heading">¶</a></h3>
<p>Suspicious network pakets did cross the TCP/IP stack and the packet
filter detected them. The resulting logs were converted by a scanner of
elos to an event looking like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>date : 123456

source.appName : kernel

source.fileName : -

source.pid : 0

severity : 0x03 (=warning)

hardwareid : myMachine

message code : 4002

classification : 0x02

payload:

{

“interface”: “eth0”,

“action”: “package dropped”,

{

... further info on the package

}

}
</pre></div>
</div>
<p>A possible reaction would be to stop all network activities and shut
down the ECU as a cybersecurity attack might be ongoing. This way elos
can be used to design a cyber security response as required in UN-ECE
R155 5.1.1 (d) <a class="footnote-reference brackets" href="#id12" id="id4" role="doc-noteref"><span class="fn-bracket">[</span>4<span class="fn-bracket">]</span></a>.</p>
<p>But it could also be fine to just store the event in the logs of elos
for later cybersecurity audits. In the latter case no receiver needs to
be implemented. This resulting log is of use for implementation of
UN-ECE R155 5.1.1 (e) “analysis of attempts of cyberattacks”.</p>
</section>
</section>
</section>
<section id="event-collection-input-side">
<h1>event collection – input side<a class="headerlink" href="#event-collection-input-side" title="Link to this heading">¶</a></h1>
<section id="input-from-scanners">
<h2>Input from scanners<a class="headerlink" href="#input-from-scanners" title="Link to this heading">¶</a></h2>
<p>On the input side elos supports loading of shared objects into the main
process. These modules scan the system for events and feed them into the
internal event queue of elos. Thus, these modules are called scanners.</p>
<p>Depending on the nature of the events, scanners poll for an event
regularly using their own threads or sleep until an event is reported.</p>
<p>Elos handles the syslog and the kernel log with dedicated scanners. They
parse the metadata of each log line for source, severity, etc. The
original line can at any time be retrieved from the payload.</p>
<p>The syslog scanner behaves like an ordinary POSIX syslogger: It receives
all log lines sent using the syslog()function. Each line is converted by
the scanner to an event in canonical format.</p>
<p>The kernel log scanner looks for logs from the kernel by reading
/dev/kmsg. Each log line from the kernel is converted to an event and
processed by elos.</p>
<p>The network scanner makes use of “netlink” <a class="footnote-reference brackets" href="#id13" id="id5" role="doc-noteref"><span class="fn-bracket">[</span>5<span class="fn-bracket">]</span></a> and “netdevice” <a class="footnote-reference brackets" href="#id14" id="id6" role="doc-noteref"><span class="fn-bracket">[</span>6<span class="fn-bracket">]</span></a> to
detect events concerning network activities like plugging of
connections, etc. Whenever a change was detected, a generic event in
canonical format is pushed to the elos queue to allow follow-up actions.</p>
</section>
<section id="input-via-api-socket">
<h2>Input via API / Socket<a class="headerlink" href="#input-via-api-socket" title="Link to this heading">¶</a></h2>
<p>Additionally to the scanners, external processes can deliver events for
processing and forwarding to elos, either via local IP or
Unix-Domain-Socket.</p>
<p>The library libelos allows easy creation of the needed protocol
structures. Any other environment not using the library needs to
implement the simple and straightforward protocol. This way applications
written in any arbitrary programming language can make use of the
logging and event handling features. It is left to system architects to
make use of this interface for highly specific events of any kind, for
example, in the application software layers.</p>
<div class="line-block">
<div class="line"><strong>Example:</strong></div>
<div class="line">A small C++-based application polls the temperature sensor every 5
seconds. If it is higher than a certain limit, an event is pushed to
elos.</div>
</div>
<p>That event is filtered and forwarded to all applications doing heavy
calculations. (e.g. doing some Artificial Intelligence) The event causes
these applications to slow down or even to stop their calculations,
which is expected to stop further temperature increases.</p>
<p><a class="reference internal" href="../_images/image3.png"><img alt="image2" src="../_images/image3.png" style="width: 6.69306in; height: 4.65in;" /></a></p>
<div class="line-block">
<div class="line"><strong>Example:</strong></div>
<div class="line">Another application using the SMART <a class="footnote-reference brackets" href="#id15" id="id7" role="doc-noteref"><span class="fn-bracket">[</span>7<span class="fn-bracket">]</span></a> tools to check the status of
the flash-based storage reports events via elos.</div>
</div>
<p>These events are received and processed by a predictive maintenance
application. This allows a replacement of the storage before it is
running out of spare sectors or it just reduces the write activities
until replacement.</p>
<p>During development or testing of a vehicle, these kinds of events can
help to forecast the degree of wear of the flash and from that the
expected end of life of the storage can be deduced and finally
optimized.</p>
</section>
<section id="security-aspects">
<h2>Security aspects<a class="headerlink" href="#security-aspects" title="Link to this heading">¶</a></h2>
<p>The receivers of events from elos usually take actions depending on the
type and content of the event. For example a receiver responsible for a
clean shutdown, will shutdown that ECU in case a battery-low event was
send in. If any process is able to send a fake low-power event via elos,
an unintended shutdown will be initialized.</p>
<p>The countermeasure to this scenario is provided by the elos input
filtering. Only previleged processes are allowed to send in such
critical events. The processes and events are defined the elos config
using rpn-filters.</p>
<p>The processes allowed to send such events are defined by their ELF-file.
In the above example a process running the executable
/usr/bin/system-manager might be allowed to send such events. If the
process has a different executable the event is refused.</p>
<p>The extensions of elos to do the event authorization via powerful
cryptographic algorithms is planned.</p>
</section>
<section id="subscribe-to-your-events">
<h2>Subscribe to ‘your’ events<a class="headerlink" href="#subscribe-to-your-events" title="Link to this heading">¶</a></h2>
<p>Via the elos IPC interface any process can register with elos for event
retrieval, e.g. by using the libelos.</p>
<p>After registration, a filter needs to be defined to start receiving
events. Any event that matches the filter is then delivered. It is now
up to the receiving process to further analyze the event or to start an
activity right away.</p>
<div class="line-block">
<div class="line"><strong>Example:</strong></div>
<div class="line">A plugged-event or link up event from the network-subsystem can be
enough of information to start connecting to a server. The analysis of
the details and the payload of the event can be omitted, making the
receiver less complex.</div>
</div>
<p>On the other hand, and depending on the nature of the event, the
receiver might need to analyze the event in detail to derive the proper
reaction. Analysis of the payload might become a more complex task as
JSON or similar structures need to be parsed.</p>
<p>Depending on this analysis, the process may react to the event in an
appropriate way, ignore it or even send another event via elos.</p>
<p>The elos filters operate on the canonical format of the events. They are
formulated in reverse polish notation (RPN) <a class="footnote-reference brackets" href="#id16" id="id8" role="doc-noteref"><span class="fn-bracket">[</span>8<span class="fn-bracket">]</span></a>. Any field of the
canonical format including the payload can be used for filtering.
Filters are allowed to use logical operators like ‘and’, ‘or’ or ‘not’,
etc, and combinations of them.</p>
<p><strong>Example</strong>:</p>
<div class="line-block">
<div class="line">Filter:</div>
<div class="line">in RPN: “.event.messageCode 2007 EQ .event.source.appName ‘sshd’ EQ
AND”</div>
<div class="line">in infix-notation: “.event.messageCode=2007 &amp;&amp; event.source.appName =
‘sshd’ ”</div>
</div>
<p>This filter maps to the 2007 Code (meaning socket open) from sshd. Hence
the receiver will be informed when the ssh-server is ready to be used.</p>
<p>Hint: The details for detecting this state are left to the input side of
elos, making event detection and handling independent.</p>
<div class="line-block">
<div class="line"><strong>Example:</strong></div>
<div class="line">Filter: “.event.messageCode 5005 EQ”</div>
<div class="line">The message code 5005 tells us that a process has crashed and
core-dumped. The resulting action could be to collect forensic data
and send them to the cloud in order to allow further analysis of the
issue. Additionally the remaining running software could use this
event to change into a safe-mode to prevent follow-up issues.</div>
</div>
<div class="line-block">
<div class="line"><strong>Example</strong></div>
<div class="line">In this design example some battery handling is assumed. A battery
monitoring process is regularly checking the conditions of all
batteries and sends events in case some relevant status has changed.
The main batteries communicate via the CAN-Bus but backup batteries
use the Linux default “power_supply” subsystem.</div>
</div>
<p>The battery monitoring process sends the following events when
appropriate:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">date</span> <span class="p">:</span> <span class="mi">123456</span>

<span class="n">source</span><span class="o">.</span><span class="n">appName</span> <span class="p">:</span> <span class="n">battery_mon</span>

<span class="n">source</span><span class="o">.</span><span class="n">fileName</span> <span class="p">:</span> <span class="o">-</span>

<span class="n">source</span><span class="o">.</span><span class="n">pid</span> <span class="p">:</span> <span class="mi">4321</span>

<span class="n">severity</span> <span class="p">:</span> <span class="mh">0x04</span> <span class="p">(</span><span class="o">=</span><span class="n">info</span><span class="p">)</span>

<span class="n">hardwareid</span> <span class="p">:</span> <span class="n">myMachine</span>

<span class="n">message</span> <span class="n">code</span> <span class="p">:</span> <span class="mi">7007</span>

<span class="n">classification</span> <span class="p">:</span> <span class="mh">0x02</span>

<span class="n">payload</span><span class="p">:</span>

<span class="p">{</span>

<span class="s2">&quot;remaining_time&quot;</span><span class="p">:</span> <span class="s2">&quot;1h&quot;</span><span class="p">,</span>

<span class="p">}</span>
</pre></div>
</div>
<p>Any receiver of this event can now react in an individual way to cope
with the fact that 1h of run time is left. Reactions could be to warn
the driver or to switch off heating.</p>
<p>Another event from the battery monitoring process could be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">date</span> <span class="p">:</span> <span class="mi">123456</span>

<span class="n">source</span><span class="o">.</span><span class="n">appName</span> <span class="p">:</span> <span class="n">battery_mon</span>

<span class="n">source</span><span class="o">.</span><span class="n">fileName</span> <span class="p">:</span> <span class="o">-</span>

<span class="n">source</span><span class="o">.</span><span class="n">pid</span> <span class="p">:</span> <span class="mi">4321</span>

<span class="n">severity</span> <span class="p">:</span> <span class="mh">0x03</span> <span class="p">(</span><span class="o">=</span><span class="n">warning</span><span class="p">)</span>

<span class="n">hardwareid</span> <span class="p">:</span> <span class="n">myMachine</span>

<span class="n">message</span> <span class="n">code</span> <span class="p">:</span> <span class="mi">7008</span>

<span class="n">classification</span> <span class="p">:</span> <span class="mh">0x02</span>

<span class="n">payload</span><span class="p">:</span>

<span class="p">{</span>

<span class="s2">&quot;remaining_time&quot;</span><span class="p">:</span> <span class="s2">&quot;30s&quot;</span><span class="p">,</span>

<span class="p">}</span>
</pre></div>
</div>
<p>With this information, each process should stop energy hungry
calculation immediately. To save power needed for storing data to flash,
a shutdown has to be expected shortly. A more fine-grained design of
events around battery monitoring should be created for an actual real
world application, but that is out of the scope of this paper.</p>
<div class="line-block">
<div class="line"><strong>Example:</strong> Software updates are installing</div>
<div class="line">A software update tooling (e.g. over-the-air updates) can make use of
elos by communicating the start and end of an update process to
prevent unwanted activities during replacement of software, or to
inform the user interface about the progress of the update.</div>
</div>
<div class="line-block">
<div class="line"><strong>Example:</strong> The flash (SSD/eMMC) is detecting issues</div>
<div class="line">Events via elos can be used to implement predictive maintenance. An
elos-scanner or any other observing process could generate events
depending on the status of the flash-storage. If the number of
total-written bytes exceeds a certain amount, or if the count of spare
blocks goes below a defined limit, an event is sent out. The reaction
to that event might be to request a hardware replacement and a
limitation of the writing activities to a minimum. The definitions of
limits and resulting actions can be freely designed by the architects
of the ECU Software.</div>
</div>
<div class="line-block">
<div class="line"><strong>Example:</strong> starting applications and containers depending on events</div>
<div class="line">With integration of an init-system that allows start, stop and control
of running processes and containers, elos enables a system design that
starts and stops applications and containers depending on the current
use-case of the vehicle.</div>
<div class="line">If a software component detects highway-driving, some containers with
specific functions for highway driving are started and the container
for parking-service is shutdown.</div>
</div>
<p><strong>Example:</strong> Get a notification on low free memory (RAM or storage)</p>
<p>The RPN-Filters can even filter with the payload if it is formulated as
JSON. Hence a possible system design could be based on regular
broadcasting of storage status events, e.g. every 5 minutes. These
events carry the actual free space in bytes in the payload. The filters
just forward the event in case the byte-count goes below e.g. 100MB and
that in turn causes a deletion of data increasing the available space
again. Within this design the decision for the trigger limit (here
100MB) was pushed to the receiving side. This shows the amount of
flexibility the system designers have when using elos and its
infrastructures.</p>
</section>
</section>
<section id="event-logging-and-storage-backends">
<h1>event logging and storage backends<a class="headerlink" href="#event-logging-and-storage-backends" title="Link to this heading">¶</a></h1>
<p>Events passing through elos and influencing all other system parts can
have a high impact on the functionality of the ECU, hence these events
need to be logged and stored for later reference. But elos events that
just occur without software that reacts to them can also play an
important role when it comes to analysis of incidents. To allow this
analysis and further audits elos stores events for later reference.</p>
<p>Logging is a critical activity with an impact on the lifetime of the
flash storage. If all log information is stored, the available capacity
of the flash will not last for a device’s lifetime. The first solution
approach to this would be to delete old logs in a circular buffer
manner. But that might not be the best solution, as the total number of
write cycles of the flash device is still in danger of being exceeded.
This would result in dramatically failing storage devices after longer
periods of use.</p>
<p>To solve this, elos has a filter-based multi-level approach of logging
events in different storage-classes. Each storage-class has a place
“where to store”, a filter “what to store”, and further parameters. The
filters make use of the generic elos filtering approach. If an event
matches to the filter of a storage class the event is logged using the
defined technology to the place defined.</p>
<div class="line-block">
<div class="line"><strong>Example:</strong></div>
<div class="line">Events with a high severity might be logged to a SQL-database residing
on the eMMC flash. Events stored here are deleted after one year.</div>
</div>
<p>Events with a higher severity are logged to a very reliable storage in
NOR-Flash using json to allow easy analysis. These types of events are
never deleted. Power-Fail-safety needs special care on this device.</p>
<p>Events with severity “debug” are logged in a NoSQL-database to a RAM
device to allow debugging. As long as no reboot occurs the data is
available.</p>
<p>Events with very low severity are just discarded.</p>
<p>Depending on the design of the storage technology, event logging with
integrity protection is possible to allow security audits with a high
reliability.</p>
<p><a class="reference internal" href="../_images/image4.png"><img alt="image3" src="../_images/image4.png" style="width: 6.69306in; height: 3.56944in;" /></a></p>
<section id="security-of-the-config">
<h2>Security of the config<a class="headerlink" href="#security-of-the-config" title="Link to this heading">¶</a></h2>
<p>The configuration details of elos are crucial for its function and hence
for the overall ECU. This leads to the need to secure the configuration
files by checking their integrity and verifying their authenticity. The
easiest way to do this is by storing the configuration immutably in a
dm-verity-secured read-only partition. However that might be impossible
as dynamic (re-)configuration is part of many system architectures.</p>
<p>To address these requirements elos supports fine-grained configuration
parameter verification where critical parameters are verified by
checking signatures. Only if this check is passed the parameter is
accepted, otherwise the default is used.</p>
<p>Non-critical parameters can be set freely in the configuration file.</p>
<div class="line-block">
<div class="line"><strong>Example:</strong></div>
<div class="line">The elos configuration for storage of events is secured with a
signature of the EBCL integration party. No one is able to modify the
storage place of events unless authorized. But the internal logging
level of elos is left open to allow different selections here.</div>
</div>
</section>
</section>
<section id="test-suite-testing-elos">
<h1>test suite testing elos<a class="headerlink" href="#test-suite-testing-elos" title="Link to this heading">¶</a></h1>
<section id="integration-tests">
<h2>Integration tests<a class="headerlink" href="#integration-tests" title="Link to this heading">¶</a></h2>
<p>elos contains a test suite that verifies correct function when installed
on a Linux-based operating system. The test suite verifies that all
components are installed and behave as defined.</p>
</section>
<section id="unit-tests">
<h2>Unit tests<a class="headerlink" href="#unit-tests" title="Link to this heading">¶</a></h2>
<p>elos has a unit test suite that picks each function out of its scope and
tests just the bare features of that particular function. Any function
that is called by the function under test (FUT) can be mocked to enable
stable testing of the function or to inject errors.</p>
</section>
</section>
<section id="documentation">
<h1>Documentation<a class="headerlink" href="#documentation" title="Link to this heading">¶</a></h1>
<p>elos comes with a full set of internal and external API documentation
along with a user-friendly manual showing the ways to use and configure
elos.</p>
</section>
<section id="conclusion">
<h1>Conclusion<a class="headerlink" href="#conclusion" title="Link to this heading">¶</a></h1>
<p>elos is a light-weight event processing framework for event driven
architectures in a Linux environment. It separates the event detection,
filtering, processing, storage, and handling and therefore simplifies
the design of application software and reduces the maintenance
complexity.</p>
<p>elos and its default scanners enable you to hook an event handler to any
line of logging printed to the default logging channels of Linux. This
eases the creation of a first working system design that is based on
elos.</p>
<p>The details for detecting event are left to the input side of elos,
making event filtering and handling independent from the technologies,
interfaces and structures of underlying linux subsystems.</p>
</section>
<section id="future-extensions">
<h1>Future extensions<a class="headerlink" href="#future-extensions" title="Link to this heading">¶</a></h1>
<p>Future extensions of elos might cover aspects of static data. elos is a
good candidate to host information that is of system wide interest but
without the character of an event, e.g. an hour-counter that just count
the time the ECU is actively running, or the number of reboots the ECU
has experienced.</p>
</section>
<section id="get-elos">
<h1>Get elos<a class="headerlink" href="#get-elos" title="Link to this heading">¶</a></h1>
<ul class="simple">
<li><p>elos is part of Elektrobit’s open-source software solutions called EB
corbos Linux – built on Ubuntu. see:
<a class="reference external" href="https://www.elektrobit.com/products/ecu/eb-corbos/linux/">https://www.elektrobit.com/products/ecu/eb-corbos/Linux/</a></p></li>
<li><p>Elektrobit is planning to start an open source community project by
summer 2023.</p></li>
<li><p>Contact us for questions: <a class="reference external" href="mailto:sales&#37;&#52;&#48;elektrobit&#46;com">sales<span>&#64;</span>elektrobit<span>&#46;</span>com</a></p></li>
</ul>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id9" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>See
<a class="reference external" href="https://medium.com/swlh/the-engineers-guide-to-event-driven-architectures-benefits-and-challenges-3e96ded8568b">https://medium.com/swlh/the-engineers-guide-to-event-driven-architectures-benefits-and-challenges-3e96ded8568b</a></p>
</aside>
<aside class="footnote brackets" id="id10" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">2</a><span class="fn-bracket">]</span></span>
<p>See RFC 7231 „Hypertext Transfer Protocol (HTTP/1.1): Semantics and
Content“</p>
</aside>
<aside class="footnote brackets" id="id11" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id3">3</a><span class="fn-bracket">]</span></span>
<p>See IEC 21778 „The JSON data interchange syntax“</p>
</aside>
<aside class="footnote brackets" id="id12" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id4">4</a><span class="fn-bracket">]</span></span>
<p>UN-ECE UN Regulation No. 155; Jan 22nd 2021</p>
</aside>
<aside class="footnote brackets" id="id13" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id5">5</a><span class="fn-bracket">]</span></span>
<p>Linux Manpage netlink(7)</p>
</aside>
<aside class="footnote brackets" id="id14" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id6">6</a><span class="fn-bracket">]</span></span>
<p>Linux Manpage netdevice(7)</p>
</aside>
<aside class="footnote brackets" id="id15" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id7">7</a><span class="fn-bracket">]</span></span>
<p>SMART was originally defined in ATA-Standard ACS-2. The features were
continued similarly as industry standard in SCSI and even Flash-based
storage like NVMe based ones.</p>
</aside>
<aside class="footnote brackets" id="id16" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id8">8</a><span class="fn-bracket">]</span></span>
<p>Also known as post fix notation. The operator follows the operands.</p>
</aside>
</aside>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/elos_blue.png" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../index.html">elos</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="userManual.html">Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="../src/demos/index.html">Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../build/Debug/doc/source_generated/api/index.html">public API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../src/index.html">Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../build/Debug/doc/source_generated/developer/api/index.html">Complete API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="Architecture_Design_Records/index.html">ADRs</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html">How we document</a></li>
<li class="toctree-l1"><a class="reference internal" href="../test/index.html">Verification Strategy or how we test</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, wolfgang.gehrhardt@emlix.com.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.2.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../_sources/doc/elos_paper.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>