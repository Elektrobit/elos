<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="../../_static/favicon_16x16.png" sizes="16x11" rel="icon" type="image/png">
    <link href="../../_static/favicon_32x32.png" sizes="32x21" rel="icon" type="image/png">
    <title>Architecture Design Record - Detecting Coredumps &#8212; elos  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=4f649999" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=039e1c02" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Architecture Design Record - elos event logging concept DRAFT" href="elos_event_logging_concept.html" />
    <link rel="prev" title="Architecture Design Record - Atomic Variables" href="atomic_variables.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="architecture-design-record-detecting-coredumps">
<h1>Architecture Design Record - Detecting Coredumps<a class="headerlink" href="#architecture-design-record-detecting-coredumps" title="Link to this heading">¶</a></h1>
<section id="problem">
<h2>Problem<a class="headerlink" href="#problem" title="Link to this heading">¶</a></h2>
<p>Kernels core dump will write a process image into processes current working directory by default. While writing the process image it does not save additional information like executable pathname, UID,GID, Number of signal causing dump, etc. . So the problem here is to check if a coredump has happened, if it has then, retrieve the coredump data and store it.</p>
</section>
<section id="influencing-factors">
<h2>Influencing factors<a class="headerlink" href="#influencing-factors" title="Link to this heading">¶</a></h2>
</section>
<section id="assumptions">
<h2>Assumptions<a class="headerlink" href="#assumptions" title="Link to this heading">¶</a></h2>
<p>The assumption is that kernel coredump pattern is accessible via the proc interface.</p>
</section>
<section id="considered-alternatives">
<h2>Considered Alternatives<a class="headerlink" href="#considered-alternatives" title="Link to this heading">¶</a></h2>
<section id="add-a-small-executable-to-forward-kernel-coredump-images-to-elosd">
<h3>Add a small executable to forward kernel coredump images to elosd.<a class="headerlink" href="#add-a-small-executable-to-forward-kernel-coredump-images-to-elosd" title="Link to this heading">¶</a></h3>
<p>To setup an own location where the dumps will be written and to add a chance to get the additional information kernels core dump provides via specifiers, a small binary that forwards this information to the elos daemon shall be created. The binary will then be run with root permission and the core dump is given as standard input.</p>
<section id="prepare-kernel-coredump-pattern">
<h4>Prepare kernel coredump pattern<a class="headerlink" href="#prepare-kernel-coredump-pattern" title="Link to this heading">¶</a></h4>
<p>The kernels coredump pattern can be set to pipe the resulting coredump
image to a user-space binary including some specifiers that will be
replaced by the kernel during binary invocation.</p>
<p>To setup the pattern automatically, <strong>as root</strong> call the <em>coredump</em> binary
without any parameters. This will setup the following coredump pattern
in <em>/proc/sys/kernel/core_pattern</em>:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="p">|</span>&lt;PATH_TO_COREDUMP_BINARY&gt;/coredump<span class="w"> </span>%P<span class="w"> </span>%E<span class="w"> </span>%u<span class="w"> </span>%g<span class="w"> </span>%s<span class="w"> </span>%t<span class="w"> </span>%h
</pre></div>
</div>
<p>See manpage (<em>man 5 core</em>) for more details about core pattern and the
different specifiers used here.</p>
</section>
<section id="trigger-a-logging-event-and-coredump-image-write">
<h4>Trigger a logging event and coredump image write<a class="headerlink" href="#trigger-a-logging-event-and-coredump-image-write" title="Link to this heading">¶</a></h4>
<p>After preparing kernel coredump pattern ensure the elosd daemon is
running. Then let an application of your choice run into a
segmentation fault to trigger kernels coredump handling.</p>
<p>The elosd logfile should then contain a logline that starts with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;messageCode&quot;</span><span class="p">:</span><span class="mi">5005</span><span class="p">,</span> <span class="o">...</span>
</pre></div>
</div>
<p>and the coredump image will be saved under <em>/tmp</em> directory as
core.&lt;timestamp&gt;.&lt;PID&gt; .</p>
</section>
<section id="manually-trigger-a-logging-event-and-coredump-image-write">
<h4>Manually trigger a logging event and coredump image write<a class="headerlink" href="#manually-trigger-a-logging-event-and-coredump-image-write" title="Link to this heading">¶</a></h4>
<p>To manually test <em>coredump</em> binaries behaviour without invoking
kernels real coredump functionality one could try with the
following steps:</p>
<ul class="simple">
<li><p>start logdaemon elosd</p></li>
<li><p>manually invoke coredump binary with some valid parameters, e.g.:</p></li>
</ul>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;THIS IS THE DUMP&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>/usr/local/bin/coredump<span class="w"> </span><span class="m">1</span><span class="w"> </span>/usr/bin/somebinary<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">333333</span><span class="w"> </span>myhostname
</pre></div>
</div>
<ul class="simple">
<li><p>then the file content of <em>/tmp/core.333333.1</em> should contain the line “THIS IS THE DUMP”</p></li>
<li><p>the elosd logfile should contain the new event line:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;topicId&quot;</span><span class="p">:</span><span class="mi">42</span><span class="p">,</span><span class="s2">&quot;topic&quot;</span><span class="p">:</span><span class="s2">&quot;COREDUMP_STARTED&quot;</span><span class="p">,</span><span class="s2">&quot;date&quot;</span><span class="p">:[</span><span class="mi">333333</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="s2">&quot;source&quot;</span><span class="p">:{</span><span class="s2">&quot;appName&quot;</span><span class="p">:</span><span class="s2">&quot;\/usr\/bin\/somebinary&quot;</span><span class="p">,</span><span class="s2">&quot;fileName&quot;</span><span class="p">:</span><span class="s2">&quot;\/usr\/bin\/somebinary&quot;</span><span class="p">,</span><span class="s2">&quot;pid&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span><span class="s2">&quot;severity&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="s2">&quot;hardwareid&quot;</span><span class="p">:</span><span class="s2">&quot;myhostname&quot;</span><span class="p">,</span><span class="s2">&quot;classification&quot;</span><span class="p">:</span><span class="mi">512</span><span class="p">,</span><span class="s2">&quot;messageCode&quot;</span><span class="p">:</span><span class="mi">5005</span><span class="p">,</span><span class="s2">&quot;payload&quot;</span><span class="p">:</span><span class="s2">&quot;core dumped to \/tmp\/core.333333.1, signal=11, UID=2, GID=3&quot;</span><span class="p">}</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="decision">
<h2>Decision<a class="headerlink" href="#decision" title="Link to this heading">¶</a></h2>
<section id="rationale">
<h3>Rationale<a class="headerlink" href="#rationale" title="Link to this heading">¶</a></h3>
</section>
<section id="open-points">
<h3>Open Points<a class="headerlink" href="#open-points" title="Link to this heading">¶</a></h3>
<p>Usage of elos-coredump in a container is not recommended presently, because elos-coredump uses the linux kernel interface <code class="docutils literal notranslate"><span class="pre">/proc/sys/kernel/core_pattern</span></code> to pipe coredump events into elosd. This
strategy works when used in a target system or an emulator, since the kernel interface is that of the target or emulator. In a container however the kernel interface is that of the host system on which the container is running. This shared interface leads to a difference in the creation of the coredump files based on how the core pattern set. When the the core pattern is an simple path to a files
like <code class="docutils literal notranslate"><span class="pre">/tmp/core.%t.%P</span></code>, when a segmentation fault occurs, the coredump file is created locally in the container file system and written to. This is not the case when the core pattern has coredump piped into an executable like <code class="docutils literal notranslate"><span class="pre">|/usr/bin/elos-coredump</span> <span class="pre">%P</span> <span class="pre">%E</span> <span class="pre">%u</span> <span class="pre">%g</span> <span class="pre">%s</span> <span class="pre">%t</span> <span class="pre">%h</span></code>, the coredump files are created in the host file system and not in the container. When the executble to which the coredump is piped is not present in the host, then the coredump file is not created. Additionally when the coredump file is created, it is in the host system, and is not not available in the container unless the file’s directory is shared with the container. Taking this behaviour into considertaion, elos-coredump shall be avoided in a container.</p>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/elos_blue.png" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../../index.html">elos</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../userManual.html">Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../src/demos/index.html">Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../build/Debug/doc/source_generated/api/index.html">public API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../src/index.html">Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../build/Debug/doc/source_generated/developer/api/index.html">Complete API Reference</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">ADRs</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html#list-of-adrs">List of ADRs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../index.html">How we document</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../test/index.html">Verification Strategy or how we test</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../github/index.html">GitHub CI</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Architecture Design Records</a><ul>
      <li>Previous: <a href="atomic_variables.html" title="previous chapter">Architecture Design Record - Atomic Variables</a></li>
      <li>Next: <a href="elos_event_logging_concept.html" title="next chapter">Architecture Design Record - elos event logging concept <strong>DRAFT</strong></a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, wolfgang.gehrhardt@emlix.com.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.2.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../_sources/doc/Architecture_Design_Records/elos-coredump.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>